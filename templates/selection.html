<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <title>选择要处理的页面</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .header {
      background: #0d6efd;
      color: #fff;
      padding: 1.5rem 0 1rem 0;
      margin-bottom: 2rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .footer {
      background: #f8f9fa;
      color: #888;
      text-align: center;
      padding: 1rem 0;
      margin-top: 3rem;
      border-top: 1px solid #e5e5e5;
      font-size: 0.95em;
    }
    .page-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 18px;
      margin-bottom: 1.5rem;
    }
    .page-preview {
      background: #fff;
      max-width: 100%;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px 8px 8px 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      transition: box-shadow .2s;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .page-preview.selected {
      border: 2px solid #0d6efd;
    }
    .page-preview img {
      width: 100%;
      height: auto;
      border-radius: 4px;
      margin-bottom: 6px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.06);
    }
    .form-check-label {
      font-size: 0.98em;
    }
    .file-title {
      font-weight: bold;
      margin-bottom: 0.5rem;
      font-size: 1.08em;
      color: #0d6efd;
    }
  </style>
</head>
<body class="bg-light">
  {% include 'header.html' %}
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-10">
        <div class="card shadow-sm">
          <div class="card-body">
            <h2 class="mb-4">选择要处理的页面</h2>
            <div class="mb-3">
              <button class="btn btn-outline-primary me-2" onclick="selectAll()">全选</button>
              <button class="btn btn-outline-primary" onclick="invertSelection()">反选</button>
            </div>
            <form method="post" action="/process-selection" id="selectionForm">
              <input type="hidden" name="task_id" value="{{ task_id }}">
              {% for file in files %}
                <div class="file-title">{{ file.name }}</div>
                <div class="page-grid">
                  {% if file.type == 'pdf' %}
                    {% for page in file.pages %}
                      <div class="page-preview">
                        <div class="form-check mb-1">
                          <input class="form-check-input page-checkbox" type="checkbox" 
                                 name="selected_pages" value="{{ file.path }}:{{ page.number }}" 
                                 id="page_{{ file.path }}_{{ page.number }}" checked>
                          <label class="form-check-label" for="page_{{ file.path }}_{{ page.number }}">
                            第 {{ page.number }} 页
                          </label>
                        </div>
                        <img src="{{ url_for('main.get_preview', filename='page_' ~ page.number ~ '.png', task_id=task_id) }}" alt="Page {{ page.number }}">
                      </div>
                    {% endfor %}
                  {% else %}
                    <div class="page-preview">
                      <img src="{{ url_for('main.get_preview', filename=file.name, task_id=task_id) }}" alt="{{ file.name }}">
                    </div>
                  {% endif %}
                </div>
              {% endfor %}
              <div class="mt-3">
                <button type="submit" class="btn btn-primary">开始处理</button>
                <a href="/" class="btn btn-link">返回</a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% include 'footer.html' %}
<script>
function selectAll() {
  document.querySelectorAll('.page-checkbox, .file-checkbox').forEach(checkbox => {
    checkbox.checked = true;
  });
}

function invertSelection() {
  document.querySelectorAll('.page-checkbox, .file-checkbox').forEach(checkbox => {
    checkbox.checked = !checkbox.checked;
  });
}

document.querySelectorAll('.file-checkbox').forEach(checkbox => {
  checkbox.addEventListener('change', function() {
    const fileCard = this.closest('.card');
    fileCard.querySelectorAll('.page-checkbox').forEach(pageCheckbox => {
      pageCheckbox.checked = this.checked;
    });
  });
});
</script>
</body>
</html> 